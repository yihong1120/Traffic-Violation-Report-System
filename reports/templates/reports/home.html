{% extends "base.html" %}

{% block content %}
<h2>Welcome to Traffic Violation Report System</h2>

{% if request.user.is_authenticated %}
    <p>Hello, {{ request.user.username }}!</p>
    <a href="{% url 'logout' %}">Logout</a>
{% else %}
    <p>Please <a href="{% url 'login' %}">login</a> to continue.</p>
{% endif %}

<div id="map-container" style="height: 400px; width: 100%;">
    <div id="map" style="height: 100%;"></div>
</div>

<script>
    function initMap() {
        var map = new google.maps.Map(document.getElementById('map'), {
            center: {lat: 23.6978, lng: 120.9605},
            zoom: 8,
            mapTypeId: 'roadmap'
        });
    
        // 使用 AJAX 请求违章数据
        fetch('/traffic-violations/')
            .then(response => response.json())
            .then(data => {
                // 用数据创建地图上的标记
                for (var i = 0; i < data.length; i++) {
                    var marker = new google.maps.Marker({
                        position: {lat: data[i].lat, lng: data[i].lng},
                        map: map,
                        title: data[i].title
                    });
                }
            });
    }
</script>

<!-- 引入 Google Maps API -->
<script src="https://maps.googleapis.com/maps/api/js?key={{ GOOGLE_MAPS_API_KEY }}&callback=initMap" async defer></script>

{% endblock %}
